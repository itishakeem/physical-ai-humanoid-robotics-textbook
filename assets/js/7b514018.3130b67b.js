"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[257],{9339:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var r=a(6540),l=a(7214),n=a(6347),i=a(6025),t=a(4848);const o="http://127.0.0.1:8000/api/auth";function d(){const e=(0,n.W6)(),[s,a]=((0,i.Ay)("/"),(0,r.useState)(null)),[d,c]=(0,r.useState)(!1),[m,p]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1),[f,x]=(0,r.useState)(null),[j,v]=(0,r.useState)(null),[g,w]=(0,r.useState)({first_name:"",last_name:"",email:"",username:"",developer_level:"Beginner"}),[N,_]=(0,r.useState)({current_password:"",new_password:"",confirm_password:""}),[b,y]=(0,r.useState)({password:"",confirmation:""}),[C,S]=(0,r.useState)({}),[P,E]=(0,r.useState)(""),[F,D]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const s=localStorage.getItem("auth_token"),r=localStorage.getItem("user");if(s&&r)try{const e=JSON.parse(r);a(e),w({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",username:e.username||"",developer_level:e.developer_level||"Beginner"});const s=localStorage.getItem(`profile_image_${e.id}`);s&&v(s)}catch(l){console.error("Error parsing user data:",l),e.push("/login")}else e.push("/login")},[e]);const k=e=>{const{name:s,value:a}=e.target;w(e=>({...e,[s]:a})),C[s]&&S(e=>({...e,[s]:""}))},T=e=>{const{name:s,value:a}=e.target;_(e=>({...e,[s]:a})),C[s]&&S(e=>({...e,[s]:""}))},I=e=>{const{name:s,value:a}=e.target;y(e=>({...e,[s]:a})),C[s]&&S(e=>({...e,[s]:""}))};return s?(0,t.jsx)(l.A,{title:"Profile",children:(0,t.jsxs)("div",{className:"profile-container",children:[(0,t.jsxs)("div",{className:"profile-hero",children:[(0,t.jsx)("h1",{className:"profile-title",children:"My Profile"}),(0,t.jsx)("p",{className:"profile-subtitle",children:"Manage your account settings and preferences"})]}),(0,t.jsxs)("div",{className:"profile-content",children:[(0,t.jsxs)("div",{className:"profile-card profile-picture-card",children:[(0,t.jsxs)("div",{className:"profile-picture-wrapper",children:[(0,t.jsx)("div",{className:"profile-picture",children:j?(0,t.jsx)("img",{src:j,alt:"Profile"}):(0,t.jsxs)("div",{className:"profile-picture-placeholder",children:[s.first_name?.[0],s.last_name?.[0]]})}),(0,t.jsxs)("label",{htmlFor:"profile-image-upload",className:"upload-button",children:["\ud83d\udcf7 Change Photo",(0,t.jsx)("input",{type:"file",id:"profile-image-upload",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(a){if(a.size>5242880)return void S({image:"Image size must be less than 5MB"});x(a);const e=new FileReader;e.onloadend=()=>{v(e.result),localStorage.setItem(`profile_image_${s.id}`,e.result)},e.readAsDataURL(a),S(e=>({...e,image:""}))}},style:{display:"none"}})]}),C.image&&(0,t.jsx)("span",{className:"error-message",children:C.image})]}),(0,t.jsxs)("div",{className:"profile-info",children:[(0,t.jsxs)("h2",{children:[s.first_name," ",s.last_name]}),(0,t.jsx)("p",{className:"profile-email",children:s.email}),(0,t.jsx)("span",{className:`developer-badge ${s.developer_level.toLowerCase()}`,children:s.developer_level})]})]}),(0,t.jsxs)("div",{className:"profile-card profile-details-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsx)("h3",{children:"Profile Information"}),!d&&(0,t.jsx)("button",{className:"edit-button",onClick:()=>c(!0),children:"\u270f\ufe0f Edit Profile"})]}),P&&(0,t.jsx)("div",{className:"success-banner",children:P}),C.submit&&(0,t.jsx)("div",{className:"error-banner",children:C.submit}),d?(0,t.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),D(!0),S({});try{await new Promise(e=>setTimeout(e,1e3));const e={...s,...g};localStorage.setItem("user",JSON.stringify(e)),a(e),E("Profile updated successfully!"),c(!1),setTimeout(()=>E(""),3e3)}catch(r){S({submit:"Failed to update profile. Please try again."})}finally{D(!1)}},className:"profile-form",children:[(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"first_name",children:"First Name"}),(0,t.jsx)("input",{type:"text",id:"first_name",name:"first_name",value:g.first_name,onChange:k,required:!0}),C.first_name&&(0,t.jsx)("span",{className:"error-message",children:C.first_name})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"last_name",children:"Last Name"}),(0,t.jsx)("input",{type:"text",id:"last_name",name:"last_name",value:g.last_name,onChange:k,required:!0}),C.last_name&&(0,t.jsx)("span",{className:"error-message",children:C.last_name})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"username",children:"Username"}),(0,t.jsx)("input",{type:"text",id:"username",name:"username",value:g.username,onChange:k,required:!0}),C.username&&(0,t.jsx)("span",{className:"error-message",children:C.username})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"email",children:"Email"}),(0,t.jsx)("input",{type:"email",id:"email",name:"email",value:g.email,onChange:k,required:!0}),C.email&&(0,t.jsx)("span",{className:"error-message",children:C.email})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"developer_level",children:"Developer Level"}),(0,t.jsxs)("select",{id:"developer_level",name:"developer_level",value:g.developer_level,onChange:k,className:"select-input",children:[(0,t.jsx)("option",{value:"Beginner",children:"Beginner"}),(0,t.jsx)("option",{value:"Intermediate",children:"Intermediate"}),(0,t.jsx)("option",{value:"Advanced",children:"Advanced"})]})]}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancel-button",onClick:()=>{c(!1),w({first_name:s.first_name,last_name:s.last_name,email:s.email,username:s.username,developer_level:s.developer_level})},children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"save-button",disabled:F,children:F?"Saving...":"Save Changes"})]})]}):(0,t.jsxs)("div",{className:"profile-details-view",children:[(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"First Name"}),(0,t.jsx)("span",{className:"detail-value",children:s.first_name})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Last Name"}),(0,t.jsx)("span",{className:"detail-value",children:s.last_name})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Username"}),(0,t.jsx)("span",{className:"detail-value",children:s.username||"Not set"})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Email"}),(0,t.jsx)("span",{className:"detail-value",children:s.email})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Developer Level"}),(0,t.jsx)("span",{className:"detail-value",children:s.developer_level})]})]})]}),(0,t.jsxs)("div",{className:"profile-card profile-password-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsx)("h3",{children:"Security"}),!m&&(0,t.jsx)("button",{className:"edit-button",onClick:()=>p(!0),children:"\ud83d\udd12 Change Password"})]}),m&&(0,t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),N.new_password===N.confirm_password)if(N.new_password.length<8)S({new_password:"Password must be at least 8 characters"});else{D(!0),S({});try{await new Promise(e=>setTimeout(e,1e3)),E("Password updated successfully!"),p(!1),_({current_password:"",new_password:"",confirm_password:""}),setTimeout(()=>E(""),3e3)}catch(s){S({submit:"Failed to update password. Please try again."})}finally{D(!1)}}else S({confirm_password:"Passwords do not match"})},className:"profile-form",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"current_password",children:"Current Password"}),(0,t.jsx)("input",{type:"password",id:"current_password",name:"current_password",value:N.current_password,onChange:T,required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"new_password",children:"New Password"}),(0,t.jsx)("input",{type:"password",id:"new_password",name:"new_password",value:N.new_password,onChange:T,minLength:8,required:!0}),C.new_password&&(0,t.jsx)("span",{className:"error-message",children:C.new_password})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"confirm_password",children:"Confirm New Password"}),(0,t.jsx)("input",{type:"password",id:"confirm_password",name:"confirm_password",value:N.confirm_password,onChange:T,required:!0}),C.confirm_password&&(0,t.jsx)("span",{className:"error-message",children:C.confirm_password})]}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancel-button",onClick:()=>{p(!1),_({current_password:"",new_password:"",confirm_password:""})},children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"save-button",disabled:F,children:F?"Updating...":"Update Password"})]})]})]}),(0,t.jsxs)("div",{className:"profile-card profile-delete-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsx)("h3",{children:"Danger Zone"}),!u&&(0,t.jsx)("button",{className:"delete-account-button",onClick:()=>h(!0),children:"\ud83d\uddd1\ufe0f Delete Account"})]}),u?(0,t.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),"DELETE"===b.confirmation)if(b.password){D(!0),S({});try{const a=localStorage.getItem("auth_token"),r=await fetch(`${o}/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({password:b.password,confirmation:b.confirmation})}),l=await r.json();if(!r.ok)throw new Error(l.detail||"Failed to delete account");localStorage.removeItem("auth_token"),localStorage.removeItem("user"),localStorage.removeItem(`profile_image_${s.id}`),alert("Your account has been deleted successfully."),e.push("/")}catch(r){S({submit:r.message||"Failed to delete account. Please try again."})}finally{D(!1)}}else S({password:"Password is required"});else S({confirmation:"Please type DELETE to confirm"})},className:"profile-form",children:[(0,t.jsxs)("div",{className:"danger-warning-box",children:[(0,t.jsx)("h4",{children:"\u26a0\ufe0f Warning: This action is irreversible!"}),(0,t.jsx)("p",{children:"Deleting your account will permanently remove:"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Your profile and personal information"}),(0,t.jsx)("li",{children:"All chat history and conversations"}),(0,t.jsx)("li",{children:"All saved data and preferences"})]}),(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"This cannot be undone!"})})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"delete_password",children:"Enter Your Password to Confirm"}),(0,t.jsx)("input",{type:"password",id:"delete_password",name:"password",value:b.password,onChange:I,placeholder:"Your current password",required:!0}),C.password&&(0,t.jsx)("span",{className:"error-message",children:C.password})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"delete_confirmation",children:'Type "DELETE" to confirm'}),(0,t.jsx)("input",{type:"text",id:"delete_confirmation",name:"confirmation",value:b.confirmation,onChange:I,placeholder:"Type DELETE in capital letters",required:!0}),C.confirmation&&(0,t.jsx)("span",{className:"error-message",children:C.confirmation})]}),C.submit&&(0,t.jsx)("div",{className:"error-banner",children:C.submit}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancel-button",onClick:()=>{h(!1),y({password:"",confirmation:""}),S({})},children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"delete-button",disabled:F,children:F?"Deleting Account...":"Delete My Account"})]})]}):(0,t.jsx)("div",{className:"danger-warning",children:(0,t.jsx)("p",{children:"\u26a0\ufe0f Deleting your account is permanent and cannot be undone. All your data will be permanently removed."})})]})]})]})}):null}}}]);