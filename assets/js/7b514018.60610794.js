"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[257],{9339:(e,s,a)=>{a.r(s),a.d(s,{default:()=>o});var r=a(6540),l=a(7214),n=a(6347),i=a(6025),t=a(4848);function o(){const e=(0,n.W6)(),[s,a]=((0,i.Ay)("/"),(0,r.useState)("http://127.0.0.1:8000/api/auth")),[o,d]=(0,r.useState)(null),[c,m]=(0,r.useState)(!1),[p,u]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),[x,j]=(0,r.useState)(null),[v,w]=(0,r.useState)(null),[g,N]=(0,r.useState)({first_name:"",last_name:"",email:"",username:"",developer_level:"Beginner"}),[_,b]=(0,r.useState)({current_password:"",new_password:"",confirm_password:""}),[y,S]=(0,r.useState)({password:"",confirmation:""}),[C,E]=(0,r.useState)({}),[P,k]=(0,r.useState)(""),[F,D]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if("undefined"!=typeof window){const e=window.location.hostname.includes("github.io");a(e?"https://physical-ai-humanoid-robotics-textbook-bgc0.onrender.com/api/auth":"http://127.0.0.1:8000/api/auth")}},[]),(0,r.useEffect)(()=>{const s=localStorage.getItem("auth_token"),a=localStorage.getItem("user");if(s&&a)try{const e=JSON.parse(a);d(e),N({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",username:e.username||"",developer_level:e.developer_level||"Beginner"});const s=localStorage.getItem(`profile_image_${e.id}`);s&&w(s)}catch(r){console.error("Error parsing user data:",r),e.push("/login")}else e.push("/login")},[e]);const T=e=>{const{name:s,value:a}=e.target;N(e=>({...e,[s]:a})),C[s]&&E(e=>({...e,[s]:""}))},I=e=>{const{name:s,value:a}=e.target;b(e=>({...e,[s]:a})),C[s]&&E(e=>({...e,[s]:""}))},A=e=>{const{name:s,value:a}=e.target;S(e=>({...e,[s]:a})),C[s]&&E(e=>({...e,[s]:""}))};return o?(0,t.jsx)(l.A,{title:"Profile",children:(0,t.jsxs)("div",{className:"profile-container",children:[(0,t.jsxs)("div",{className:"profile-hero",children:[(0,t.jsx)("h1",{className:"profile-title",children:"My Profile"}),(0,t.jsx)("p",{className:"profile-subtitle",children:"Manage your account settings and preferences"})]}),(0,t.jsxs)("div",{className:"profile-content",children:[(0,t.jsxs)("div",{className:"profile-card profile-picture-card",children:[(0,t.jsxs)("div",{className:"profile-picture-wrapper",children:[(0,t.jsx)("div",{className:"profile-picture",children:v?(0,t.jsx)("img",{src:v,alt:"Profile"}):(0,t.jsxs)("div",{className:"profile-picture-placeholder",children:[o.first_name?.[0],o.last_name?.[0]]})}),(0,t.jsxs)("label",{htmlFor:"profile-image-upload",className:"upload-button",children:["\ud83d\udcf7 Change Photo",(0,t.jsx)("input",{type:"file",id:"profile-image-upload",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){if(s.size>5242880)return void E({image:"Image size must be less than 5MB"});j(s);const e=new FileReader;e.onloadend=()=>{w(e.result),localStorage.setItem(`profile_image_${o.id}`,e.result)},e.readAsDataURL(s),E(e=>({...e,image:""}))}},style:{display:"none"}})]}),C.image&&(0,t.jsx)("span",{className:"error-message",children:C.image})]}),(0,t.jsxs)("div",{className:"profile-info",children:[(0,t.jsxs)("h2",{children:[o.first_name," ",o.last_name]}),(0,t.jsx)("p",{className:"profile-email",children:o.email}),(0,t.jsx)("span",{className:`developer-badge ${o.developer_level.toLowerCase()}`,children:o.developer_level})]})]}),(0,t.jsxs)("div",{className:"profile-card profile-details-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsx)("h3",{children:"Profile Information"}),!c&&(0,t.jsx)("button",{className:"edit-button",onClick:()=>m(!0),children:"\u270f\ufe0f Edit Profile"})]}),P&&(0,t.jsx)("div",{className:"success-banner",children:P}),C.submit&&(0,t.jsx)("div",{className:"error-banner",children:C.submit}),c?(0,t.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),D(!0),E({});try{await new Promise(e=>setTimeout(e,1e3));const e={...o,...g};localStorage.setItem("user",JSON.stringify(e)),d(e),k("Profile updated successfully!"),m(!1),setTimeout(()=>k(""),3e3)}catch(s){E({submit:"Failed to update profile. Please try again."})}finally{D(!1)}},className:"profile-form",children:[(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"first_name",children:"First Name"}),(0,t.jsx)("input",{type:"text",id:"first_name",name:"first_name",value:g.first_name,onChange:T,required:!0}),C.first_name&&(0,t.jsx)("span",{className:"error-message",children:C.first_name})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"last_name",children:"Last Name"}),(0,t.jsx)("input",{type:"text",id:"last_name",name:"last_name",value:g.last_name,onChange:T,required:!0}),C.last_name&&(0,t.jsx)("span",{className:"error-message",children:C.last_name})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"username",children:"Username"}),(0,t.jsx)("input",{type:"text",id:"username",name:"username",value:g.username,onChange:T,required:!0}),C.username&&(0,t.jsx)("span",{className:"error-message",children:C.username})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"email",children:"Email"}),(0,t.jsx)("input",{type:"email",id:"email",name:"email",value:g.email,onChange:T,required:!0}),C.email&&(0,t.jsx)("span",{className:"error-message",children:C.email})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"developer_level",children:"Developer Level"}),(0,t.jsxs)("select",{id:"developer_level",name:"developer_level",value:g.developer_level,onChange:T,className:"select-input",children:[(0,t.jsx)("option",{value:"Beginner",children:"Beginner"}),(0,t.jsx)("option",{value:"Intermediate",children:"Intermediate"}),(0,t.jsx)("option",{value:"Advanced",children:"Advanced"})]})]}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancel-button",onClick:()=>{m(!1),N({first_name:o.first_name,last_name:o.last_name,email:o.email,username:o.username,developer_level:o.developer_level})},children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"save-button",disabled:F,children:F?"Saving...":"Save Changes"})]})]}):(0,t.jsxs)("div",{className:"profile-details-view",children:[(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"First Name"}),(0,t.jsx)("span",{className:"detail-value",children:o.first_name})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Last Name"}),(0,t.jsx)("span",{className:"detail-value",children:o.last_name})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Username"}),(0,t.jsx)("span",{className:"detail-value",children:o.username||"Not set"})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Email"}),(0,t.jsx)("span",{className:"detail-value",children:o.email})]}),(0,t.jsxs)("div",{className:"detail-item",children:[(0,t.jsx)("span",{className:"detail-label",children:"Developer Level"}),(0,t.jsx)("span",{className:"detail-value",children:o.developer_level})]})]})]}),(0,t.jsxs)("div",{className:"profile-card profile-password-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsx)("h3",{children:"Security"}),!p&&(0,t.jsx)("button",{className:"edit-button",onClick:()=>u(!0),children:"\ud83d\udd12 Change Password"})]}),p&&(0,t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),_.new_password===_.confirm_password)if(_.new_password.length<8)E({new_password:"Password must be at least 8 characters"});else{D(!0),E({});try{await new Promise(e=>setTimeout(e,1e3)),k("Password updated successfully!"),u(!1),b({current_password:"",new_password:"",confirm_password:""}),setTimeout(()=>k(""),3e3)}catch(s){E({submit:"Failed to update password. Please try again."})}finally{D(!1)}}else E({confirm_password:"Passwords do not match"})},className:"profile-form",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"current_password",children:"Current Password"}),(0,t.jsx)("input",{type:"password",id:"current_password",name:"current_password",value:_.current_password,onChange:I,required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"new_password",children:"New Password"}),(0,t.jsx)("input",{type:"password",id:"new_password",name:"new_password",value:_.new_password,onChange:I,minLength:8,required:!0}),C.new_password&&(0,t.jsx)("span",{className:"error-message",children:C.new_password})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"confirm_password",children:"Confirm New Password"}),(0,t.jsx)("input",{type:"password",id:"confirm_password",name:"confirm_password",value:_.confirm_password,onChange:I,required:!0}),C.confirm_password&&(0,t.jsx)("span",{className:"error-message",children:C.confirm_password})]}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancel-button",onClick:()=>{u(!1),b({current_password:"",new_password:"",confirm_password:""})},children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"save-button",disabled:F,children:F?"Updating...":"Update Password"})]})]})]}),(0,t.jsxs)("div",{className:"profile-card profile-delete-card",children:[(0,t.jsxs)("div",{className:"card-header",children:[(0,t.jsx)("h3",{children:"Danger Zone"}),!h&&(0,t.jsx)("button",{className:"delete-account-button",onClick:()=>f(!0),children:"\ud83d\uddd1\ufe0f Delete Account"})]}),h?(0,t.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),"DELETE"!==y.confirmation)return void E({confirmation:"Please type DELETE to confirm"});if(!y.password)return void E({password:"Password is required"});D(!0),E({});const a="undefined"!=typeof window&&window.location.hostname.includes("github.io")?"https://physical-ai-humanoid-robotics-textbook-bgc0.onrender.com/api/auth":"http://127.0.0.1:8000/api/auth";try{const s=localStorage.getItem("auth_token"),r=await fetch(`${a}/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({password:y.password,confirmation:y.confirmation})}),l=await r.json();if(!r.ok)throw new Error(l.detail||"Failed to delete account");localStorage.removeItem("auth_token"),localStorage.removeItem("user"),localStorage.removeItem(`profile_image_${o.id}`),alert("Your account has been deleted successfully."),e.push("/")}catch(r){E({submit:r.message||"Failed to delete account. Please try again."})}finally{D(!1)}},className:"profile-form",children:[(0,t.jsxs)("div",{className:"danger-warning-box",children:[(0,t.jsx)("h4",{children:"\u26a0\ufe0f Warning: This action is irreversible!"}),(0,t.jsx)("p",{children:"Deleting your account will permanently remove:"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Your profile and personal information"}),(0,t.jsx)("li",{children:"All chat history and conversations"}),(0,t.jsx)("li",{children:"All saved data and preferences"})]}),(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"This cannot be undone!"})})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"delete_password",children:"Enter Your Password to Confirm"}),(0,t.jsx)("input",{type:"password",id:"delete_password",name:"password",value:y.password,onChange:A,placeholder:"Your current password",required:!0}),C.password&&(0,t.jsx)("span",{className:"error-message",children:C.password})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"delete_confirmation",children:'Type "DELETE" to confirm'}),(0,t.jsx)("input",{type:"text",id:"delete_confirmation",name:"confirmation",value:y.confirmation,onChange:A,placeholder:"Type DELETE in capital letters",required:!0}),C.confirmation&&(0,t.jsx)("span",{className:"error-message",children:C.confirmation})]}),C.submit&&(0,t.jsx)("div",{className:"error-banner",children:C.submit}),(0,t.jsxs)("div",{className:"form-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancel-button",onClick:()=>{f(!1),S({password:"",confirmation:""}),E({})},children:"Cancel"}),(0,t.jsx)("button",{type:"submit",className:"delete-button",disabled:F,children:F?"Deleting Account...":"Delete My Account"})]})]}):(0,t.jsx)("div",{className:"danger-warning",children:(0,t.jsx)("p",{children:"\u26a0\ufe0f Deleting your account is permanent and cannot be undone. All your data will be permanently removed."})})]})]})]})}):null}}}]);