"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[2531],{1101:(e,s,t)=>{t.r(s),t.d(s,{default:()=>u});var a=t(6540),i=t(7214),n=t(8259),r=t(6025),c=t(6347),o=t(4769),l=t(4848);const d=o.i.AUTH_URL;function u(){const{login:e}=(0,n.A)(),s=(0,c.W6)(),t=(0,r.Ay)(""),o=(0,r.Ay)("/signup"),[u,h]=(0,a.useState)(["","","","","",""]),[m,p]=(0,a.useState)(""),[f,g]=(0,a.useState)({}),[x,y]=(0,a.useState)(!1),[j,b]=(0,a.useState)(!1),[v,T]=(0,a.useState)(!1),[N,S]=(0,a.useState)(0),k=(0,a.useRef)([]);(0,a.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("email"),t=localStorage.getItem("pending_signup_email");if(e)p(e),localStorage.setItem("pending_signup_email",e);else{if(!t)return void s.push(o);p(t)}S(60)},[s]),(0,a.useEffect)(()=>{if(N>0){const e=setTimeout(()=>S(N-1),1e3);return()=>clearTimeout(e)}},[N]);return v?(0,l.jsx)(i.A,{title:"Email Verified",children:(0,l.jsx)("div",{className:"auth-container",children:(0,l.jsxs)("div",{className:"auth-card success-card",children:[(0,l.jsx)("div",{className:"success-icon",children:"\u2713"}),(0,l.jsx)("h2",{children:"Email Verified Successfully!"}),(0,l.jsx)("p",{children:"Your account has been created. Redirecting you to the homepage..."})]})})}):(0,l.jsx)(i.A,{title:"Verify Email",children:(0,l.jsx)("div",{className:"auth-container",children:(0,l.jsxs)("div",{className:"auth-card",children:[(0,l.jsxs)("div",{className:"auth-header",children:[(0,l.jsx)("h1",{children:"Verify Your Email"}),(0,l.jsxs)("p",{children:["We've sent a 6-digit code to ",(0,l.jsx)("strong",{children:m})]}),(0,l.jsxs)("div",{className:"info-banner",style:{background:"#e3f2fd",border:"1px solid #2196f3",borderRadius:"8px",padding:"12px",marginTop:"16px",fontSize:"14px",color:"#1565c0"},children:["\ud83d\udca1 ",(0,l.jsx)("strong",{children:"Development Mode:"})," Check your backend terminal/console for the OTP code. It will appear as: ",(0,l.jsxs)("code",{children:["INFO: OTP for ",m,": 123456"]})]})]}),(0,l.jsxs)("form",{onSubmit:async a=>{a.preventDefault();const i=u.join("");if(6===i.length){y(!0),g({});try{const a=await fetch(`${d}/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m,otp_code:i})}),n=await a.json();if(!a.ok)throw new Error(n.detail||"OTP verification failed");e(n.access_token,n.user),localStorage.removeItem("pending_signup_email"),T(!0),setTimeout(()=>{s.push(t)},2e3)}catch(n){g({submit:n.message||"Invalid or expired OTP. Please try again."}),h(["","","","","",""]),k.current[0]?.focus()}finally{y(!1)}}else g({otp:"Please enter the complete 6-digit code"})},className:"auth-form",children:[(0,l.jsx)("div",{className:"otp-container",children:u.map((e,s)=>(0,l.jsx)("input",{ref:e=>k.current[s]=e,type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:e=>((e,s)=>{if(s&&!/^\d$/.test(s))return;const t=[...u];t[e]=s,h(t),f.otp&&g(e=>({...e,otp:""})),s&&e<5&&k.current[e+1]?.focus()})(s,e.target.value),onKeyDown:e=>((e,s)=>{"Backspace"===s.key&&!u[e]&&e>0&&k.current[e-1]?.focus(),"v"===s.key&&(s.ctrlKey||s.metaKey)&&(s.preventDefault(),navigator.clipboard.readText().then(e=>{const s=e.replace(/\D/g,"").slice(0,6).split(""),t=[...u];s.forEach((e,s)=>{s<6&&(t[s]=e)}),h(t),k.current[Math.min(s.length,5)]?.focus()}))})(s,e),className:"otp-input "+(f.otp?"error":""),disabled:x,autoFocus:0===s},s))}),f.otp&&(0,l.jsx)("span",{className:"error-message otp-error",children:f.otp}),f.submit&&(0,l.jsx)("div",{className:"error-banner "+(f.submit.includes("resent")?"success-banner":""),children:f.submit}),(0,l.jsx)("button",{type:"submit",className:"auth-button",disabled:x||6!==u.join("").length,children:x?"Verifying...":"Verify Email"}),(0,l.jsxs)("div",{className:"auth-footer",children:[(0,l.jsxs)("p",{children:["Didn't receive the code?"," ",N>0?(0,l.jsxs)("span",{className:"countdown",children:["Resend in ",N,"s"]}):(0,l.jsx)("button",{type:"button",onClick:async()=>{if(!(N>0)){b(!0),g({});try{const e=await fetch(`${d}/resend-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m})}),s=await e.json();if(!e.ok)throw new Error(s.detail||"Failed to resend OTP");S(60),g({submit:"OTP resent successfully! Check your email."}),h(["","","","","",""]),k.current[0]?.focus()}catch(e){g({submit:e.message||"Failed to resend OTP. Please try again."})}finally{b(!1)}}},disabled:j,className:"resend-link",children:j?"Sending...":"Resend OTP"})]}),(0,l.jsx)("p",{style:{marginTop:"12px"},children:(0,l.jsx)("a",{href:"/signup",children:"Change email address"})})]})]})]})})})}}}]);