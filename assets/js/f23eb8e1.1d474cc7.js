"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[2531],{1101:(e,t,s)=>{s.r(t),s.d(t,{default:()=>l});var i=s(6540),a=s(7214),n=s(8259),o=s(6025),r=s(6347),c=s(4848);function l(){const{login:e}=(0,n.A)(),t=(0,r.W6)(),s=(0,o.Ay)(""),l=(0,o.Ay)("/signup"),[d,u]=(0,i.useState)("http://127.0.0.1:8000/api/auth"),[h,p]=(0,i.useState)(["","","","","",""]),[m,f]=(0,i.useState)(""),[g,b]=(0,i.useState)({}),[y,x]=(0,i.useState)(!1),[j,w]=(0,i.useState)(!1),[v,k]=(0,i.useState)(!1),[S,T]=(0,i.useState)(0),N=(0,i.useRef)([]);(0,i.useEffect)(()=>{if("undefined"!=typeof window){const e=window.location.hostname.includes("github.io");u(e?"https://physical-ai-humanoid-robotics-textbook-bgc0.onrender.com/api/auth":"http://127.0.0.1:8000/api/auth")}},[]),(0,i.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("email"),s=localStorage.getItem("pending_signup_email");if(e)f(e),localStorage.setItem("pending_signup_email",e);else{if(!s)return void t.push(l);f(s)}T(60)},[t]),(0,i.useEffect)(()=>{if(S>0){const e=setTimeout(()=>T(S-1),1e3);return()=>clearTimeout(e)}},[S]);return v?(0,c.jsx)(a.A,{title:"Email Verified",children:(0,c.jsx)("div",{className:"auth-container",children:(0,c.jsxs)("div",{className:"auth-card success-card",children:[(0,c.jsx)("div",{className:"success-icon",children:"\u2713"}),(0,c.jsx)("h2",{children:"Email Verified Successfully!"}),(0,c.jsx)("p",{children:"Your account has been created. Redirecting you to the homepage..."})]})})}):(0,c.jsx)(a.A,{title:"Verify Email",children:(0,c.jsx)("div",{className:"auth-container",children:(0,c.jsxs)("div",{className:"auth-card",children:[(0,c.jsxs)("div",{className:"auth-header",children:[(0,c.jsx)("h1",{children:"Verify Your Email"}),(0,c.jsxs)("p",{children:["We've sent a 6-digit code to ",(0,c.jsx)("strong",{children:m})]}),(0,c.jsxs)("div",{className:"info-banner",style:{background:"#e3f2fd",border:"1px solid #2196f3",borderRadius:"8px",padding:"12px",marginTop:"16px",fontSize:"14px",color:"#1565c0"},children:["\ud83d\udca1 ",(0,c.jsx)("strong",{children:"Development Mode:"})," Check your backend terminal/console for the OTP code. It will appear as: ",(0,c.jsxs)("code",{children:["INFO: OTP for ",m,": 123456"]})]})]}),(0,c.jsxs)("form",{onSubmit:async i=>{i.preventDefault();const a=h.join("");if(6!==a.length)return void b({otp:"Please enter the complete 6-digit code"});x(!0),b({});const n="undefined"!=typeof window&&window.location.hostname.includes("github.io")?"https://physical-ai-humanoid-robotics-textbook-bgc0.onrender.com/api/auth":"http://127.0.0.1:8000/api/auth";try{const i=await fetch(`${n}/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m,otp_code:a})}),o=await i.json();if(!i.ok)throw new Error(o.detail||"OTP verification failed");e(o.access_token,o.user),localStorage.removeItem("pending_signup_email"),k(!0),setTimeout(()=>{t.push(s)},2e3)}catch(o){b({submit:o.message||"Invalid or expired OTP. Please try again."}),p(["","","","","",""]),N.current[0]?.focus()}finally{x(!1)}},className:"auth-form",children:[(0,c.jsx)("div",{className:"otp-container",children:h.map((e,t)=>(0,c.jsx)("input",{ref:e=>N.current[t]=e,type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:e=>((e,t)=>{if(t&&!/^\d$/.test(t))return;const s=[...h];s[e]=t,p(s),g.otp&&b(e=>({...e,otp:""})),t&&e<5&&N.current[e+1]?.focus()})(t,e.target.value),onKeyDown:e=>((e,t)=>{"Backspace"===t.key&&!h[e]&&e>0&&N.current[e-1]?.focus(),"v"===t.key&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),navigator.clipboard.readText().then(e=>{const t=e.replace(/\D/g,"").slice(0,6).split(""),s=[...h];t.forEach((e,t)=>{t<6&&(s[t]=e)}),p(s),N.current[Math.min(t.length,5)]?.focus()}))})(t,e),className:"otp-input "+(g.otp?"error":""),disabled:y,autoFocus:0===t},t))}),g.otp&&(0,c.jsx)("span",{className:"error-message otp-error",children:g.otp}),g.submit&&(0,c.jsx)("div",{className:"error-banner "+(g.submit.includes("resent")?"success-banner":""),children:g.submit}),(0,c.jsx)("button",{type:"submit",className:"auth-button",disabled:y||6!==h.join("").length,children:y?"Verifying...":"Verify Email"}),(0,c.jsxs)("div",{className:"auth-footer",children:[(0,c.jsxs)("p",{children:["Didn't receive the code?"," ",S>0?(0,c.jsxs)("span",{className:"countdown",children:["Resend in ",S,"s"]}):(0,c.jsx)("button",{type:"button",onClick:async()=>{if(S>0)return;w(!0),b({});const e="undefined"!=typeof window&&window.location.hostname.includes("github.io")?"https://physical-ai-humanoid-robotics-textbook-bgc0.onrender.com/api/auth":"http://127.0.0.1:8000/api/auth";try{const t=await fetch(`${e}/resend-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m})}),s=await t.json();if(!t.ok)throw new Error(s.detail||"Failed to resend OTP");T(60),b({submit:"OTP resent successfully! Check your email."}),p(["","","","","",""]),N.current[0]?.focus()}catch(t){b({submit:t.message||"Failed to resend OTP. Please try again."})}finally{w(!1)}},disabled:j,className:"resend-link",children:j?"Sending...":"Resend OTP"})]}),(0,c.jsx)("p",{style:{marginTop:"12px"},children:(0,c.jsx)("a",{href:"/signup",children:"Change email address"})})]})]})]})})})}}}]);