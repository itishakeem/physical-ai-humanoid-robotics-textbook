"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[2531],{1101:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var i=s(6540),n=s(7214),a=s(8259),o=s(6025),r=s(6347),c=s(4769),l=s(4848);const d=c.i.AUTH_URL;function u(){const{login:e}=(0,a.A)(),t=(0,r.W6)(),s=(0,o.Ay)(""),c=(0,o.Ay)("/signup"),[u,h]=(0,i.useState)(["","","","","",""]),[p,m]=(0,i.useState)(""),[f,g]=(0,i.useState)({}),[y,x]=(0,i.useState)(!1),[b,j]=(0,i.useState)(!1),[v,T]=(0,i.useState)(!1),[w,N]=(0,i.useState)(0),S=(0,i.useRef)([]);(0,i.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("email"),s=localStorage.getItem("pending_signup_email");if(e)m(e),localStorage.setItem("pending_signup_email",e);else{if(!s)return void t.push(c);m(s)}N(60)},[t]),(0,i.useEffect)(()=>{if(w>0){const e=setTimeout(()=>N(w-1),1e3);return()=>clearTimeout(e)}},[w]);return v?(0,l.jsx)(n.A,{title:"Email Verified",children:(0,l.jsx)("div",{className:"auth-container",children:(0,l.jsxs)("div",{className:"auth-card success-card",children:[(0,l.jsx)("div",{className:"success-icon",children:"\u2713"}),(0,l.jsx)("h2",{children:"Email Verified Successfully!"}),(0,l.jsx)("p",{children:"Your account has been created. Redirecting you to the homepage..."})]})})}):(0,l.jsx)(n.A,{title:"Verify Email",children:(0,l.jsx)("div",{className:"auth-container",children:(0,l.jsxs)("div",{className:"auth-card",children:[(0,l.jsxs)("div",{className:"auth-header",children:[(0,l.jsx)("h1",{children:"Verify Your Email"}),(0,l.jsxs)("p",{children:["We've sent a 6-digit code to ",(0,l.jsx)("strong",{children:p})]}),(0,l.jsxs)("div",{className:"info-banner",style:{background:"#e3f2fd",border:"1px solid #2196f3",borderRadius:"8px",padding:"12px",marginTop:"16px",fontSize:"14px",color:"#1565c0"},children:["\ud83d\udca1 ",(0,l.jsx)("strong",{children:"Development Mode:"})," Check your backend terminal/console for the OTP code. It will appear as: ",(0,l.jsxs)("code",{children:["INFO: OTP for ",p,": 123456"]})]})]}),(0,l.jsxs)("form",{onSubmit:async i=>{i.preventDefault();const n=u.join("");if(6===n.length){x(!0),g({});try{const i=await fetch(`${d}/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,otp_code:n})}),a=await i.json();if(!i.ok)throw new Error(a.detail||"OTP verification failed");e(a.access_token,a.user),localStorage.removeItem("pending_signup_email"),T(!0),setTimeout(()=>{t.push(s)},2e3)}catch(a){g({submit:a.message||"Invalid or expired OTP. Please try again."}),h(["","","","","",""]),S.current[0]?.focus()}finally{x(!1)}}else g({otp:"Please enter the complete 6-digit code"})},className:"auth-form",children:[(0,l.jsx)("div",{className:"otp-container",children:u.map((e,t)=>(0,l.jsx)("input",{ref:e=>S.current[t]=e,type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:e=>((e,t)=>{if(t&&!/^\d$/.test(t))return;const s=[...u];s[e]=t,h(s),f.otp&&g(e=>({...e,otp:""})),t&&e<5&&S.current[e+1]?.focus()})(t,e.target.value),onKeyDown:e=>((e,t)=>{"Backspace"===t.key&&!u[e]&&e>0&&S.current[e-1]?.focus(),"v"===t.key&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),navigator.clipboard.readText().then(e=>{const t=e.replace(/\D/g,"").slice(0,6).split(""),s=[...u];t.forEach((e,t)=>{t<6&&(s[t]=e)}),h(s),S.current[Math.min(t.length,5)]?.focus()}))})(t,e),className:"otp-input "+(f.otp?"error":""),disabled:y,autoFocus:0===t},t))}),f.otp&&(0,l.jsx)("span",{className:"error-message otp-error",children:f.otp}),f.submit&&(0,l.jsx)("div",{className:"error-banner "+(f.submit.includes("resent")?"success-banner":""),children:f.submit}),(0,l.jsx)("button",{type:"submit",className:"auth-button",disabled:y||6!==u.join("").length,children:y?"Verifying...":"Verify Email"}),(0,l.jsxs)("div",{className:"auth-footer",children:[(0,l.jsxs)("p",{children:["Didn't receive the code?"," ",w>0?(0,l.jsxs)("span",{className:"countdown",children:["Resend in ",w,"s"]}):(0,l.jsx)("button",{type:"button",onClick:async()=>{if(!(w>0)){j(!0),g({});try{const e=await fetch(`${d}/resend-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p})}),t=await e.json();if(!e.ok)throw new Error(t.detail||"Failed to resend OTP");N(60),g({submit:"OTP resent successfully! Check your email."}),h(["","","","","",""]),S.current[0]?.focus()}catch(e){g({submit:e.message||"Failed to resend OTP. Please try again."})}finally{j(!1)}}},disabled:b,className:"resend-link",children:b?"Sending...":"Resend OTP"})]}),(0,l.jsx)("p",{style:{marginTop:"12px"},children:(0,l.jsx)("a",{href:"/signup",children:"Change email address"})})]})]})]})})})}},4769:(e,t,s)=>{s.d(t,{i:()=>a});"undefined"!=typeof window&&window.location.hostname;const i="undefined"!=typeof window&&window.location.hostname.includes("github.io"),n=process.env.REACT_APP_BACKEND_URL||(i?"https://physical-ai-humanoid-robotics-textbook-bgc0.onrender.com":"http://127.0.0.1:8000"),a={BACKEND_URL:`${n}/chat`,CHAT_HISTORY_URL:`${n}/api/chat-history`,AUTH_URL:`${n}/api/auth`}}}]);